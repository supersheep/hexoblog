---
layout: post
title: js事件绑定执行顺序
date: 2011-06-23 18:30:53
comments: true
tags: 
---

今天干活的时候碰到了很诡异的事情。
一个属性莫名在我认为所有操作都应该完成了之后被设成了错误的值。
找了半天发现是在一个没注意的地方多绑定了一次事件。
一开始以为和ie下的ajax是否异步有关系，其实就是事件绑定执行顺序的事儿。

很简单一段代码：

<pre lang="javascript">
elem.addEvent('click',function(){alert('first')});
elem.addEvent('click',function(){alert('second')});
</pre>

在ie6,7,8下都是后绑定的函数先执行，其他浏览器则是先绑定先执行。
啊！太傻逼了！

言归正传，我认为这一层应该由类库去避免掉。
就是同一个elem，同一个事件类型，永远只允许绑定一个事件。
有多个事件绑定上来的时候就往自己管理的一个堆栈里压。
这样触发的时候，就不是直接执行响应绑定函数，而是去这个堆栈里挨个执行响应函数。
道理上就可以避免这种状况了，当然参数什么的还要重新绑一下。

话说这种底层的东西好没热情自己去实现一下啊，就这么着吧= =。
既然ie9已经没有这个问题了，证明m$自己也觉得以前那样很傻逼吧，不管了不管了，统统给我升级浏览器去。