---
layout: post
title: Mootools事件代理2
date: 2011-05-16 09:14:08
comments: true
tags: 
---

之前po出来的事件代理太过简单，有不少缺陷，比如绑定的子对象存在层级关系时，事件触发就不能保持原有的冒泡顺序了。另外由于当时是取的e.target，所以只有当被代理的元素是最里层元素时菜靠谱，所以基本还是个残废=v=

因为马上就要出去玩了，这周的工作也没有安排太多，除了内部项目，主要就折腾这个了。当时没什么头绪，参考了前辈的代码很久，嚼透之后的感想就是这么简单个东西我为什么会花那么久去琢磨啊= =

废话少说，上demo！[http://jsfiddle.net/Z7NhR/](http://jsfiddle.net/Z7NhR/)大家可以自行修改下玩玩。

其实最后很多思路和自己想的差不多，结构上这种写法感觉有点像jQuery插件的作风，自己的函数在一个大闭包里，最后再留个小辫子到外面来。模拟事件冒泡的关键函数就是_getBubbleElem这个了，每次触发外层监听容器(holder)的事件时，去算一遍事件队列中的事件所有者到它的距离，以此排个序再依次去触发就可以了。删除事件的时候去事件队列里把和参数相匹配的项拿掉就是。