---
layout: post
title: 多对多数据库要怎么设计呢
date: 2010-05-22 22:32:59
comments: true
tags: 
---

在涉及到多对多数据库的设计的时候遇上了一点困惑，横竖都不好。

比方说文章和标签的关系。一篇文章可以有多个标签，一个标签对应多篇文章。

那么标签这个字段应不应该放在文章表里呢？

**1.如果标签字段直接放文章表里：**

那么列出某篇文章的标签就会十分方便。按文章id去找标签就好了。

但是如果我要列出所有的标签就会非常麻烦。（从每篇文章中找出文章标签字段，分割成一个个标签放到一起，再计算其中有多少非重复的，若需要再累计每个标签出现了多少次）

**2.标签字段另行管理：**

也就是另外建一个专门管标签的表。再建一个管标签和文章对应关系的表。

这样找出所有标签的工作只要在对应关系表里面做个查询就可以了。需要标签名字的话再和标签表连接一下，也不烦。

但是如果我要在文章列表里列出每篇文章的所有标签又麻烦了。每次从结果集里面fetch出一行之后还要再根据文章id去对应关系表和标签表里找出该文章的所有id，把他们连接成字符串，再放到刚才那行里面。如果结果集的每一行又已经放到一个二维数组里面还会更加麻烦。

**那么，有没有两全的办法呢？**

首先我想到的是，又有专门的标签表，又有文章表里的字段不就行了嘛。这边更新的时候根据要求连带更新到那边，要烦也就更新的时候烦一次。查询起来的时候就方便了。

但是不对呀，这样只能在编程的时候控制，但是数据库那边没那么智能的，不会连带更新的，一不小心就会产生数据不一致了。不可取不可取。

所以说，我就没辙了。要是数据库外键的级联更新可以根据一个自定义的函数来就方便了啊。

不知道现有的网站都是怎么做的。我看了下wordpress的，采用的是第二种做法。豆瓣比较偷懒，直接不显示。比方说这个页面：[http://movie.douban.com/tag/科幻](http://movie.douban.com/tag/科幻)，你不会看到某个电影的所有标签。

不知道同学们有什么高见没有。